<html>

<head>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
    crossorigin="" />

  <script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js" integrity="sha512-tAGcCfR4Sc5ZP5ZoVz0quoZDYX5aCtEm/eu1KhSLj2c9eFrylXZknQYmxUssFaVJKvvc0dJQixhGjG2yXWiV9Q=="
    crossorigin="">

    </script>
  <script src="Simplified_County_Boundaries.js"></script>
</head>

<body>
  <div id="bagsDiv"></div>
  <div id="teamsDiv"></div>
  <div id="profilesDiv"></div>

  <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase.js"></script>
  <scipt src="countyMap.html"></scipt>
  <script src="https://unpkg.com/@mapbox/leaflet-pip@latest/leaflet-pip.js"></script>
  <script>
    //these are the variables that point to useful numbers
    let totalBagsDropped;
    let totalTeams;
    let totalProfiles;

    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyAjwSCpOvLPgYcFr26V3gmfwJlGb-VtWAs",
      authDomain: "greenupvermont-de02b.firebaseapp.com",
      databaseURL: "https://greenupvermont-de02b.firebaseio.com",
      projectId: "greenupvermont-de02b",
      storageBucket: "greenupvermont-de02b.appspot.com",
      messagingSenderId: "439621369113"
    };
    const email = "WillyNillyLoman@gmail.com"
    const password = "burlingtonCA"

    firebase.initializeApp(config);
    var database = firebase.database();

    // var teams = firebase.database().ref('teams');

    firebase.auth().signInWithEmailAndPassword(email, password).catch(function (error) {
      // Handle Errors here.
      var errorCode = error.code;
      var errorMessage = error.message;
      // ...
    });
    let trashDropsObject;
    let bagCountArray = [];

    let addisonCountyBagsArray = [];
    let benningtonCountyBagsArray = [];
    let caledoniaCountyBagsArray = [];
    let chittendenCountyBagsArray = [];
    let essexCountyBagsArray = [];
    let franklinCountyBagsArray = [];
    let grandIsleCountyBagsArray = [];
    let lamoilleCountyBagsArray = [];
    let orangeCountyBagsArray = [];
    let orleansCountyBagsArray = [];
    let rutlandCountyBagsArray = [];
    let washingtonCountyBagsArray = [];
    let windhamCountyBagsArray = [];
    let windsorCountyBagsArray = [];



    function getTotalBags() {
      var trashDrops = firebase
        .database()
        .ref('trashDrops/')
        .on('value', function (snapshot) {
          let bagCountArray = []
          trashDropsObject = snapshot.val()
          for (var key in trashDropsObject) {
            bagCountArray.push(trashDropsObject[key].bagCount)
          }
          totalBagsDropped = bagCountArray.reduce(function (total, currentValue) {
            return total + currentValue;
          }, 0);
          document.getElementById("bagsDiv").textContent = "Total bags dropped in VT: " + totalBagsDropped

        })
    }

    function getTotalProfiles() {
      var teams = firebase
        .database()
        .ref('profiles/')
        .on('value', function (snapshot) {
          let profilesCountArray = []
          profilesCountObject = snapshot.val()
          for (var key in profilesCountObject) {
            profilesCountArray.push(profilesCountObject[key])
          }
          totalProfiles = profilesCountArray.length
          document.getElementById("profilesDiv").textContent = "Total profiles in VT: " + totalProfiles

        })
    }

    function getTotalTeams() {
      var profiles = firebase
        .database()
        .ref('teams/')
        .on('value', function (snapshot) {
          let teamsCountArray = []
          teamCountObject = snapshot.val()
          for (var key in teamCountObject) {
            teamsCountArray.push(teamCountObject[key])
          }
          totalTeams = teamsCountArray.length
          document.getElementById("teamsDiv").textContent = "Total teams in VT: " + totalTeams

        })
    }

    function buildCountyBagsArrays() {
      var trashDrops = firebase
        .database()
        .ref('trashDrops/')
        .on('value', function (snapshot) {
          trashDropsObject = snapshot.val()
          for (var key in trashDropsObject) {
            let countyBoundaries = L.geoJSON(countyPolygons);
            let keyCoordinates = [trashDropsObject[key].location.longitude, trashDropsObject[key].location.latitude]
            var results = leafletPip.pointInLayer(keyCoordinates, countyBoundaries)
            console.log(trashDropsObject[key])

            if (results[0].feature.properties.CNTYNAME === 'ADDISON') {
              addisonCountyBagsArray.push(trashDropsObject[key].bagCount);
              // console.log("addison: " + addisonCountyBagsArray)
            }
            else if (results[0].feature.properties.CNTYNAME === 'BENNINGTON') {
              benningtonCountyBagsArray.push(trashDropsObject[key].bagCount);
              // console.log("bennington: " + benningtonCountyBagsArray)
            }
            else if (results[0].feature.properties.CNTYNAME === 'CALEDONIA') {
              caledoniaCountyBagsArray.push(trashDropsObject[key].bagCount);
              // console.log("caledonia: " + caledoniaCountyBagsArray)
            }
            else if (results[0].feature.properties.CNTYNAME === 'CHITTENDEN') {
              chittendenCountyBagsArray.push(trashDropsObject[key].bagCount);
              // console.log("chittenden: " + chittendenCountyBagsArray)
            }
            else if (results[0].feature.properties.CNTYNAME === 'ESSEX') {
              essexCountyBagsArray.push(trashDropsObject[key].bagCount);
              // console.log("essex: " + essexCountyBagsArray)
            }
            else if (results[0].feature.properties.CNTYNAME === 'FRANKLIN') {
              franklinCountyBagsArray.push(trashDropsObject[key].bagCount);
              // console.log("Franklin:" + franklinCountyBagsArray)
            }
            else if (results[0].feature.properties.CNTYNAME === 'GRANDISLE') {
              grandIsleCountyBagsArray.push(trashDropsObject[key].bagCount);
              // console.log("grandIsle: " + grandIsleCountyBagsArray)
            }
            else if (results[0].feature.properties.CNTYNAME === 'LAMOILLE') {
              lamoilleCountyBagsArray.push(trashDropsObject[key].bagCount);
              // console.log("lamoille: " + lamoilleCountyBagsArray)
            }
            else if (results[0].feature.properties.CNTYNAME === 'ORANGE') {
              orangeCountyBagsArray.push(trashDropsObject[key].bagCount);
              // console.log("orange: " + orangeCountyBagsArray)
            }
            else if (results[0].feature.properties.CNTYNAME === 'ORLEANS') {
              orleansCountyBagsArray.push(trashDropsObject[key].bagCount);
              // console.log("orleans: " + orleansCountyBagsArray)
            }
            else if (results[0].feature.properties.CNTYNAME === 'RUTLAND') {
              rutlandCountyBagsArray.push(trashDropsObject[key].bagCount);
              // console.log('rutland: ' + rutlandCountyBagsArray)
            }
            else if (results[0].feature.properties.CNTYNAME === 'WASHINGTON') {
              washingtonCountyBagsArray.push(trashDropsObject[key].bagCount);
              // console.log("washington: " + washingtonCountyBagsArray)
            }
            else if (results[0].feature.properties.CNTYNAME === 'WINDHAM') {
              windhamCountyBagsArray.push(trashDropsObject[key].bagCount);
              //console.log("windham: " + windhamCountyBagsArray)
            }
            else if (results[0].feature.properties.CNTYNAME === 'WINDSOR') {
              windsorCountyBagsArray.push(trashDropsObject[key].bagCount);
              // console.log("windsor: " + windsorCountyBagsArray)
            }
          }
            (addisonCountyBagsArray.length)
            (benningtonCountyBagsArray.length)
            (caledoniaCountyBagsArray.length)
            (chittendenCountyBagsArray.length)
            (essexCountyBagsArray.length)
            (franklinCountyBagsArray.length)
            (grandIsleCountyBagsArray.length)
            (lamoilleCountyBagsArray.length)
            (orangeCountyBagsArray.length)
            (orleansCountyBagsArray.length)
            (rutlandCountyBagsArray.length)
            (washingtonCountyBagsArray.length)
            (windhamCountyBagsArray.length)
            (windsorCountyBagsArray.length)
        })
    }


    getTotalBags();
    getTotalTeams();
    getTotalProfiles();
    buildCountyBagsArrays();


  </script>
</body>

</html>